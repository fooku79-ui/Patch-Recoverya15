name: RECOVERY

on:
  workflow_dispatch:
    inputs:
      RECOVERY_URL:
        description: 'Direct download URL to recovery.img (your presigned Cloudflare link)'
        required: true
        default: ''

concurrency:
  group: recovery-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Check Out (with LFS)
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Prepare environment
        run: |
          set -euxo pipefail
          sudo apt-get update -y
          sudo apt-get install -y git wget curl lz4 tar unzip openssl python3 file
          git lfs install
          git lfs pull

      - name: Verify magiskboot is present
        run: |
          set -euxo pipefail
          ls -lh || true
          test -f magiskboot || (echo "ERROR: magiskboot not found in repo root"; exit 1)
          file magiskboot || true
          chmod +x magiskboot

      - name: Shim hardcoded magiskboot path used by script2.sh
        run: |
          set -euxo pipefail
